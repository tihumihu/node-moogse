var express = require('express')var cookieParser = require('cookie-parser')var connect = require('connect')var path = require('path')var logger = require('morgan')var mongoose= require('mongoose')var session = require('express-session')var bodyParser= require('body-parser')var mongoStore = require('connect-mongo')(session)var port = process.env.PORT || 3000var app =express()// movie为mongodb的一个数据库var dbUrl = "mongodb://localhost/movie"mongoose.connect(dbUrl)app.set('views','./app/views/pages')app.set('view engine','jade')app.use(logger('dev'));app.use(bodyParser.json());var errorHandler = require('errorhandler');app.use(bodyParser.urlencoded({ extended: true }));app.use(express.static(path.join(__dirname,'public')))app.use(cookieParser());app.use(session({ secret: 'movie', resave: true, saveUninitialized: true, store: new mongoStore({  url:dbUrl,  collection:'sessions' })}))app.listen(port)app.locals.moment = require('moment')/*if('development' == app.get('env')){ app.set('showStackError',true) app.user(logger(':method :url :status'))}*/// 开发模式if ('development' == app.get('env')) { app.use(errorHandler());}require('./config/routes')(app)console.log('immoc started on port'+port)